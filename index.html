<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity Web Player | Kotilo</title>
    <style>
      body { text-align: center; padding: 20px; font-family: sans-serif; }
      #start-view, #unity-container { margin: auto; }
      #unity-container { position: relative; }
      #start-button { font-size: 1.5em; padding: 10px 20px; cursor: pointer; }
      #unity-canvas { background: #231F20; }

      #loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      #loading-bar-container {
        width: 80%;
        max-width: 400px;
        height: 30px;
        background-color: #333;
        border: 2px solid #555;
        border-radius: 15px;
        overflow: hidden;
      }

      #loading-bar-fill {
        width: 0%;
        height: 100%;
        background-color: #F08700;
        transition: width 0.2s ease-in-out;
      }

      #loading-text {
        margin-top: 15px;
        color: white;
        font-size: 1.2em;
      }
    </style>
  </head>
  <body>

    <div id="start-view">
      <h1>"Kotilo"</h1>
      <p>Press the button to start</p>
      <button id="start-button">Start</button>
    </div>

    <div id="unity-container" width=1440 height=810 style="display: none; width: 1440px; height: 810px;">
      <canvas id="unity-canvas" width=1440 height=810 tabindex="-1" style="width: 1440px; height: 810px; background: #231F20"></canvas>
    </div>

    <div id="loading-overlay" style="display: none;">
      <div id="loading-bar-container">
        <div id="loading-bar-fill"></div>
      </div>
      <p id="loading-text">Initializing...</p>
    </div>

    <script src="Build/Kotilo.loader.js"></script>

    <script>
      const startView = document.querySelector("#start-view");
      const unityContainer = document.querySelector("#unity-container");
      const startButton = document.querySelector("#start-button");
      const canvas = document.querySelector("#unity-canvas");

      const loadingOverlay = document.querySelector("#loading-overlay");
      const loadingBarFill = document.querySelector("#loading-bar-fill");
      const loadingText = document.querySelector("#loading-text");

      let unityInstance = null;

      startButton.addEventListener("click", () => {   
        startView.style.display = "none";     
        unityContainer.style.display = "block";
        loadingOverlay.style.display = "flex";

        const buildConfig = {
          dataUrl: "Build/Kotilo.data.unityweb",
          frameworkUrl: "Build/Kotilo.framework.js.unityweb",
          codeUrl: "Build/Kotilo.wasm.unityweb",
          streamingAssetsUrl: "StreamingAssets",
          companyName: "OAMK",
          productName: "Kotilo",
          productVersion: "0.9.1",
          matchWebGLToCanvasSize: false, // Uncomment this to separately control WebGL canvas render size and DOM element size.
          devicePixelRatio: 1, // Uncomment this to override low DPI rendering on high DPI displays.
        };
        createUnityInstance(canvas, buildConfig, (progress) => {
          loadingBarFill.style.width = progress * 100 + "%";
          //console.log(`Loading... ${Math.round(progress * 100)}%`);
          if (progress < 0.9) {
            loadingText.innerText = "Downloading... " + Math.round(progress * 100) + "%";
          } else {
            loadingText.innerText = "Starting...";
          }
        }).then((instance) => {
          unityInstance = instance;
          loadingOverlay.style.display = "none";
        }).catch((message) => {
          loadingText.innerText = "ERROR: " + message;
        alert(message);
        });
      });
    </script>
  </body>
</html>
